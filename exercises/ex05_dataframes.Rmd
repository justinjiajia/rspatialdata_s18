---
title: "<span class='ex-title'>Spatial Analysis with R:</span><br/><span class='ex-subtitle'>Exercise 5: Working with Data Frames</span>"
date: "`r load('../common/course_info.RData'); lstCI$course`"
output: 
  html_document: 
    css: "../common/slidy_styles.css"
    self_contained: no
    lib_dir: lib
    smart: no
    includes:
      in_header: "../common/header.html"
      after_body: bottom_links.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::knit_hooks$set(small.mar = function(before, options, envir) {
    if (before) par(mar = c(2, 2, 0.5, 0.5))
})
source("auton_chop.R")
load('../common/course_info.RData')
```

### Instructions

- If you haven't already, install [R](https://cran.r-project.org/) and [RStudio](https://www.rstudio.com/products/rstudio/download/). 

- Download the <a href="`r lstCI$githubrepo`" target="_blank">GitHub repo</a>. 

- Create a new R script in RStudio (File &rarr; New File &rarr; R Script). 

- Copy the questions below (all of which begin with the _#_ character so RStudio will interpret them as a comment) into your script. Under each question, write R code. Run each line of R code as you enter it (press the Run button or ctrl+enter) to make sure it works.

- Remember to save your script periodically to avoid losing work if RStudio crashes.

- If you get stuck, click on the 'hint' link, or the question number to see the answer. Click again to hide.

- If you have any questions or problems, please feel free to email the instructor.

- Some of the functions you may want to use in this exercise include:

<div style="width:410px; margin-left:6em;">
<div style="width:200px;font-family:monospace;float:right;">
read.csv()  
sample()  
sd()  
sort()    
summary()  
table()  
tolower()  
unique()  
</div>

<div style="width:200px; font-family:monospace;">
class()  
data()  
head()  
hist()  
mean()  
names()  
nrow()  
plot()  
range()  
</div>
</div>

<hr class="hrdivider">
<div class="copy-button"><button onclick="CopyToClipboard('qtn_div');return false;">Copy questions</button></div>
<div id="qtn_div" class="ex-qtn">

`r hashtitle("Exploring Data Frames")`

\# `r chop("R comes with a bunch of sample datasets. To see a list of the main ones in the *datasets* package, run <tt>data()</tt> without an argument. The 'trees' dataset contains measurements of Black Cherry Trees.")`

<a id="qtn_supikf" href="#" class="showhidelink" onclick="showHide('supikf');return false;">\# `r auton()`</a> `r chop("What are the column names of the *trees* data frame?")`  

<div id="supikf" class="answer-code">
```{r}
names(trees)
```
</div>

<a id="qtn_mpmcru" href="#" class="showhidelink" onclick="showHide('mpmcru');return false;">\# `r auton()`</a> `r chop("How many samples (rows) are in the *trees* data frame?")`  

<div id="mpmcru" class="answer-code">
```{r}
nrow(trees)
```
</div>

<a id="qtn_cukbok" href="#" class="showhidelink" onclick="showHide('cukbok');return false;">\# `r auton()`</a> `r chop("Write expressions that return the range, mean, and standard deviation of the *Height* column.")` <a href="#" class="showhidehint" onclick="showHide('tjquew');return false;"></a>  

<div id="tjquew" class="hint">Look for functions other than <tt>summary()</tt></div>

<div id="cukbok" class="answer-code">
```{r}
range(trees$Height)
mean(trees$Height)
sd(trees$Height)
```
</div>

`r hashtitle("Basic Plotting")`

<a id="qtn_sfgkcj" href="#" class="showhidelink" onclick="showHide('sfgkcj');return false;">\# `r auton()`</a> `r chop("Make a scatterplot of the tree volume as a function of girth and height. Which one looks more correlated?")` <a href="#" class="showhidehint" onclick="showHide('apzwtt');return false;"></a>  

<div id="apzwtt" class="hint">Use the <tt>plot()</tt> function, with girth on the x-axis and volume on the y-axis. Use <tt>pch=16</tt> to make the symbols little circles.</div>

<div id="sfgkcj" class="answer-code">
```{r plot_trees, small.mar=TRUE}
plot(x=trees$Girth, y=trees$Volume, pch=16)
plot(x=trees$Height, y=trees$Volume, pch=16)
```

Visually it looks like tree girth is more tightly correlated with canopy volume. Perhaps that's why foresters are always measuring DBH (diameter breast height).

</div>

<a id="qtn_kfailp" href="#" class="showhidelink" onclick="showHide('kfailp');return false;">\# `r auton()`</a> `r chop("Create a box-and-whiskers plots of the *Volume* column.")` <a href="#" class="showhidehint" onclick="showHide('boqdjo');return false;"></a>  

<div id="boqdjo" class="hint">We haven't seen the function that makes a box and whiskers plot yet, so your first job is to find it.</div>  

<div id="kfailp" class="answer-code">
```{r bplot_trees, small.mar=TRUE}
boxplot(trees$Volume, main="Volume")
```
</div>

`r hashtitle("DATA FRAME MANIPULATIONS")`

<a id="qtn_eblhoo" href="#" class="showhidelink" onclick="showHide('eblhoo');return false;">\# `r auton()`</a> `r chop("A common technique in regression is to scale variables to find non-linear relationships. Add two new columns to the trees data frame, i) height squared, and ii) log(height).")`  

<div id="eblhoo" class="answer-code">
```{r}
trees$HeightSquared <- trees$Height ^ 2
trees$HeightLog <- log(trees$Height)
head(trees)
```

You could also use the <tt>transform()</tt> function, or the <tt>mutate()</tt> function from the *dplyr* package.

</div>

<a id="qtn_lqavvi" href="#" class="showhidelink" onclick="showHide('lqavvi');return false;">\# `r auton()`</a> `r chop("Randomly select 80% of the samples (rows) from the *trees* data frame, and save them as a new object called *trees_training*.")`   

<div id="lqavvi" class="answer-code">
```{r}
samp_size <- round(0.8 * nrow(trees))
samp_size
idx <- sample(1:nrow(trees), size=samp_size, replace=FALSE)
idx
trees_training <- trees[idx, ]
nrow(trees_training)
```
</div>

`r hashtitle("IMPORTING CSV FILES")`

<a id="qtn_lykudu" href="#" class="showhidelink" onclick="showHide('lykudu');return false;">\# `r auton()`</a> `r chop("Import the csv file *ca_celltowers.csv* from the data folder (in the exercises folder), saving the result as *ca_celltowers_df*.")` <a href="#" class="showhidehint" onclick="showHide('wixins');return false;"></a>  

<div id="wixins" class="hint">You can use RStudio's Import Dataset wizard to generate all the arguments for the <tt>read.csv()</tt> command. CSV files are text files.</div>
  
<div id="lykudu" class="answer-code">
```{r}
ca_celltowers_df <- read.csv("data/ca_celltowers.csv")
```
</div>

<a id="qtn_oytxly" href="#" class="showhidelink" onclick="showHide('oytxly');return false;">\# `r auton()`</a> `r chop("How many cell towers are saved in the table? How many licensed cell tower companies are represented?")` <a href="#" class="showhidehint" onclick="showHide('mpzfto');return false;"></a>  

<div id="mpzfto" class="hint">Think about how you can get rid of duplicates so you're just left with unique values.</div>
  

<div id="oytxly" class="answer-code">
```{r}
nrow(ca_celltowers_df)
unique(ca_celltowers_df$LICENSEE)
```

There are 25 unique licensed cell tower companies.

</div>

`r hashtitle("QUERIES")`

<a id="qtn_reemfy" href="#" class="showhidelink" onclick="showHide('reemfy');return false;">\# `r auton()`</a> `r chop("The built-in *iris* data frame has sepal and petal measurements for three species of flowers. Create a data frame that contains every 10th row of iris.")` <a href="#" class="showhidehint" onclick="showHide('faieao');return false;"></a>  

<div id="faieao" class="hint">Think about row indices and sequences</div>

<div id="reemfy" class="answer-code">
```{r}
idx <- seq(from=1, to=nrow(iris), by=10)
idx
iris_everytenth <- iris[idx,]
```
</div>

<a id="qtn_itfzam" href="#" class="showhidelink" onclick="showHide('itfzam');return false;">\# `r auton()`</a> `r chop("Create a data frame that stores just the Petal measurements (length and width) for the species *virginica*.")`  

<div id="itfzam" class="answer-code">
```{r}
virginica_petal <- iris[iris$Species == "virginica", c("Species", "Petal.Length", "Petal.Width")]
summary(virginica_petal)
```
</div>


<a id="qtn_wxkxmg" href="#" class="showhidelink" onclick="showHide('wxkxmg');return false;">\# `r auton()`</a> `r chop("Modify the expression above to create a data frame of petal measurements for all species __other than__ *virginica*.")`  

<div id="wxkxmg" class="answer-code">
```{r}
setosa_versicolor_petal <- iris[iris$Species != "virginica", c("Species", "Petal.Length", "Petal.Width")]
summary(setosa_versicolor_petal)
```
</div>

</div><!-- end questions -->



